import { setcolor } from './grid.js';

let preset_preview_idx = 0;

let preset_map = {
  "Hire Me": [
      "00000000000000000000000000000000000000000000000000000",
      "00004100410444440044441004444400000040004104444400000",
      "00004100410004100041004104100000000044044104100000000",
      "00004444410004100044440004444400000041404104444400000",
      "00004100410004100041004104100000000041004104100000000",
      "00004100410444440041004104444400000041004104444400000",
      "00000000000000000000000000000000000000000000000000000",
  ],

  "Stripes": [
      "00011122233344433322211100011122233344433322211100011",
      "00111222333444333222111000111222333444333222111000111",
      "01112223334443332221110001112223334443332221110001112",
      "11122233344433322211100011122233344433322211100011122",
      "11222333444333222111000111222333444333222111000111222",
      "12223334443332221110001112223334443332221110001112223",
      "22233344433322211100011122233344433322211100011122233",
  ],

  "Fade": [
      "00010001001110111122122222223323233333344344444444444",
      "00000010010111111121222322222333233433332443444444444",
      "00000100100111121212223223322223333433333444444444444",
      "00100000011011111112222222223333334344344344444444444",
      "00000010001111111212223322233333333343343444444444444",
      "00100010000101211111222222233334334434434444444444444",
      "00000100010111121212223233233333333333434434444444444",
  ],

  "Fade 2": [
      "44444444444344333333232332222222122111101110010001000",
      "44444444434423333433233322222322212111111101001000000",
      "44444444444433333433332222332232221212111100100100000",
      "44444444444344344343333332222222221111111011000000100",
      "44444444444434334333333333222332221211111110001000000",
      "44444444444443443443343333222222211111210100001000100",
      "44444444443443433333333333233232221212111101000100000",
  ],

  "Random": [
      "12244140231130102024121310342401420403311012030323432",
      "32112131410414012014134041430424022023102230240343041",
      "31011132043223013214012321011220400300303213342144232",
      "00003104011333231021321243230103230401411220031144110",
      "24041433433302430434413044103410102302301121000211124",
      "41013014112143421001041213230111203103140144233333000",
      "34044033144100321230244233323102414003343303121432421",
  ],

  "Random 2": [
      "00000000000000000000000000000000000000000000000000000",
      "32112131410414012014134041430424022023102230240343041",
      "31011132043223013214012321011220400300303213342144232",
      "00003104011333231021321243230103230401411220031144110",
      "24041433433302430434413044103410102302301121000211124",
      "41013014112143421001041213230111203103140144233333000",
      "00000000000000000000000000000000000000000000000000000",
  ],

  "Eyes": [
      "00020000000000000000000000000000000000000000000020000",
      "00020000000333333333000000000000033333333300000020000",
      "00120000003111444111300000000000311144411130000021000",
      "00120000031114444411130001100003111444441113000021000",
      "00120000003111444111300001100000311144411130000021000",
      "00020000000333333333000002200000033333333300000020000",
      "00020000000000000000000022220000000000000000000020000",
  ],

  "Clear": [
      "00000000000000000000000000000000000000000000000000000",
      "00000000000000000000000000000000000000000000000000000",
      "00000000000000000000000000000000000000000000000000000",
      "00000000000000000000000000000000000000000000000000000",
      "00000000000000000000000000000000000000000000000000000",
      "00000000000000000000000000000000000000000000000000000",
      "00000000000000000000000000000000000000000000000000000",
  ],
};

function click_preset_button(key) {
  preset_preview_idx = null;
  apply_preset(key);
}

function apply_preset(key) {
  let svg = document.getElementById("git-grid");
  let i = 0;
  for (const [week_idx, week] of svg.childNodes.entries()) {
    if (week.nodeName != "#text") {
      for (const [weekday_idx, weekday] of week.childNodes.entries()) {
        if (weekday.nodeName != "#text") {
          setTimeout(() => {
            setcolor(weekday, preset_map[key][weekday_idx][week_idx]);
          }, 3 * i + 100);

          setTimeout(() => {
            setcolor(weekday, i % 5);
          }, 3 * i);
          i += 1;
        }
      }
    }
  }
}


function presets_auto_preview() {
  let next_preview = () => {
    if (preset_preview_idx !== null) {
      let preset = Object.keys(preset_map)[preset_preview_idx];
      apply_preset(preset);
      preset_preview_idx = (preset_preview_idx + 1) % Object.keys(preset_map).length;
    }
  };
  setInterval(next_preview, 3000);
  next_preview();
}

export function presets_init() {
  let preset_grid = document.getElementById("presets");
  for (let [key, value] of Object.entries(preset_map)) {
    // make and attach a "preset" div
    let preset = document.createElement("div");
    preset.classList.add("preset");
    preset_grid.appendChild(preset);

    // make and attach a button
    let button = document.createElement("button");
    button.classList.add("button");
    // attach text to the button
    let text = document.createTextNode(key);
    button.appendChild(text);
    // attach an onclick function
    button.onclick = () => click_preset_button(key);

    preset.appendChild(button);
  }

  presets_auto_preview();
}
